<div class="container-fluid">
  <div class="row">

    <perfect-scrollbar class="scrClass" wheel-propagation="true" wheel-speed="1" min-scrollbar-length="20" auto-height>
      <uib-tabset justified="false">
        <uib-tab heading="Auth Key">
          <div class="pd2">
            <form name="authKeyForm" novalidate role="form">
              <div class="form-group">
                <input type="text" placeholder="Auth Key" class="form-control" ng-model="userAuthKey"/>
              </div>
              <div class="form-group">
                <button class="btn btn-info" ng-click="regenerateKey()">Regenerate Auth Key</button>
              </div>
            </form>
          </div>
        </uib-tab>
        <!-- end of auth tab tab -->

        <uib-tab heading="Wallet" active="true">
          <div class="pd2">
            <h3 class="fs16 mrB1">Payment details</h3>
            <label class="mrB1">Current Balance
              {{basicInfo.availableCredit}}
            <!-- <span ng-bind-html="basicInfo.availableCredit"></span> -->  &#x20B9;</label>
            <p class="mrB1"><a href="javascript:void(0)" ng-click="getUserTransaction()">Transaction details</a></p>

            <!-- modal start -->
            <script type="text/ng-template" id="prevTransDetail.html">
              <div class="modal-header themeBg">
                <button type="button" class="close" data-dismiss="modal" ng-click="$dismiss()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h3 class="modal-title">Transaction details</h3>
              </div>
              <div class="modal-body" style="max-height:300px; overflow:auto">
                <!-- no data start -->
                <div class="no-data" ng-show="noData" style="margin-top:0">
                  <h1>Sorry, No Data Found!</h1>
                  <img src="/public/webapp/images/no-data.png" alt="">
                </div>
                <!-- nodata end -->
                <div ng-hide="noData">
                  <table class="table table-striped table-bordered">
                    <thead>
                      <tr>
                        <th>Amount</th>
                        <th>Date</th>
                        <th>Transaction ID</th>
                        <th>Status</th>
                        <th>Description</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr ng-repeat="value in uTransData.paymentDetail">
                        <td>
                          <span ng-bind-html="value.balance.amount"></span>
                          <span class="text-success" ng-if="value.balance.type == 'CREDIT'">
                            (CR)
                          </span>
                          <span class="text-danger" ng-if="value.balance.type == 'DEBIT'">
                            (DR)
                          </span>
                        </td>
                        <td ng-bind-html="value.paymentDate | moment: 'format': 'MMM DD, YYYY' "></td>
                        <td ng-bind-html="value.paymentId"></td>
                        <td ng-bind-html="value.paymentStatus"></td>
                        <td>
                          {{value.companyName}}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <button ng-hide="uTransData.totalPages <= 1" ng-disabled="nothingToLoadUser" class="btn btn-primary" ng-click="pageChanged(uTransData)">Load more</button>

                </div>
              </div>
            </script>

            <!-- modal end -->

            <section>
              <form name="walletForm" novalidate class="form-inline">
                <div class="form-group mrR1 " ng-class="(walletForm.amount.$valid  && walletForm.amount.$touched) ? 'has-success' : (walletForm.amount.$touched) ? 'has-error' : '' ">
                  <input ng-disabled="wlt.status" type="text" name="amount" placeholder="Amount" class="form-control max100" ng-model="wlt.Amnt" ng-minlength="3" ng-maxlength="7" autocomplete="off" required valid-number/>
                </div>
                <div class="form-group">
                  <button ng-disabled="walletForm.$invalid" class="btn btn-success" ng-click="addMoneyInWallet()">Add money in wallet</button>
                </div>
              </form>
            </section>
            <!-- section one end -->

            <section ng-show="payStep2">
              <div class="bdrT mrT2 mrB2"></div>
              <p class="lead mrB1">
                You are making a payment of {{wlt.Amnt}}  &#x20B9;
                <small class="mrL1" style="font-size:14px">
                  <a href="javascript:void(0)" ng-click="resetSteps()">Edit</a>
                </small>
              </p>
              <div class="checkbox">
                <label>
                  <input ng-change="resetDiscount(isHaveCoupon)" ng-model="isHaveCoupon" type="checkbox">Have a coupon code
                </label>
              </div>
              <form class="form-inline mrB2" name="couponForm" novalidate ng-show="isHaveCoupon">
                <div class="form-group mrR1" ng-class="(couponForm.couponcode.$valid  && couponForm.couponcode.$touched) ? 'has-success' : (couponForm.couponcode.$touched) ? 'has-error' : '' ">
                  <input type="text" name="couponcode" class="form-control max200" ng-model="coupon.code" placeholder="Coupon code" required autocomplete="off">
                </div>
                <button ng-disabled="couponForm.$invalid" class="btn btn-primary" ng-click="redeemCoupon(coupon.code)">Redeem</button>
              </form>

              <uib-alert ng-repeat="alert in payAlert" type="{{alert.type}}" close="closeAlert($index)">{{alert.msg}}</uib-alert>

              <div ng-if="directPay">
                <div class="search-loading">
                  <span class="spinner small"></span> Please wait we are recharging your wallet
                </div>
              </div>
              <div class="">
                <button ng-disabled="disableRazorPay" razor-pay class="btn btn-primary">Pay with Razorpay</button>
              </div>
            </section>
            <!-- end of section -->
            

          </div>
        </uib-tab>
        <!-- end of wallet tab -->

        <uib-tab heading="Subscription list" ng-click="getSubscriptionList()">
          <div class="pd2">
            <!-- no data start -->
            <div class="no-data" ng-hide="cSubsData" style="margin-top:0">
              <h1>Sorry, No Data Found!</h1>
              <img src="/public/webapp/images/no-data.png" alt="">
            </div>
            <!-- nodata end -->

            <table ng-show="cSubsData" class="table table-striped table-bordered">
              <thead>
                <tr>
                  <th>Company Name</th>
                  <th>Auto deduct</th>
                  <th>Plan type</th>
                  <th>Subscription Date</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="value in subListData">
                  <td ng-bind-html="value.companyName"></td>
                  <td>
                    <switch ng-change="changeCallback" name="autopay" on="On" off="Off" ng-model="value.autoDeduct" class="wide"></switch>
                  </td>
                  <td ng-bind-html="value.servicePlan.amount"></td>
                  <td ng-bind-html="value.subscriptionDate | moment: 'format': 'MMM DD, YYYY' "></td>
                </tr>
              </tbody>
            </table>
          </div>
        </uib-tab>
        <!-- end of subscription list tab -->

        <uib-tab ng-if="canManageCompany" heading="Linked Accounts" select="loadYodlee()">
          <div class="pd2 clearfix">
            <h1>Add Bank Account<!--  <i class="glyphicon glyphicon-question-sign"></i> --></h1>
            <div class="max350 mrT1">
              <ui-select ng-model="banks.list" theme="bootstrap" on-select="selectBank($select.selected)">
                <ui-select-match placeholder="Select Accounts">
                  <span>{{$select.selected.defaultDisplayName}}</span>
                </ui-select-match >
                <ui-select-choices 
                  repeat="bank in banks.banksList | filter: $select.search" refresh="fetchSiteList($select.search)" refresh-delay="500">
                  <span ng-bind-html="bank.defaultDisplayName"></span>
                </ui-select-choices>
              </ui-select>
            </div>
            <form class="clearfix" name="addAccountForm" novalidate ng-if="banks.list != undefined" ng-submit="addAccountForm.$valid && submitForm(bankDetails)">
              <div class="row pdT2 pdR">
                <div class="col-xs-4">
                 <section class="greyBox">

                    <p class="form-group">Submit Form to Add Bank</p>

                    <div class="form-group" ng-repeat="field in banks.components">

                      <ng-form name="innerform" ng-if="field.fieldType.typeName != 'OPTIONS'"
                      ng-class="(innerform.input.$valid  && innerform.input.$touched) ? 'has-success' : (innerform.input.$touched) ? 'has-error' : '' "
                      >
                        <input autocomplete="off" id="{{field.name}}" type="{{field.name}}" ng-model="bankDetails[field.displayName]" placeholder="{{field.displayName}}" class="form-control" name="input" maxlength="{{field.maxlength}}" ng-required="!field.isOptional"/>
                        <div class="error-msg" ng-show="innerform.input.$error.required && innerform.input.$touched">Required</div>
                      </ng-form>

                      <ng-form name="innerform" ng-if="field.fieldType.typeName == 'OPTIONS'">
                        <ui-select ng-model="bankDetails[field.displayName]" theme="bootstrap">
                          <ui-select-match placeholder="Select Options">
                            <span>{{$select.selected.name}}</span>
                          </ui-select-match >
                          <ui-select-choices 
                            repeat="val.value as val in field.fieldOptions | filter: $select.search">
                            <span ng-bind-html="val.name"></span>
                          </ui-select-choices>
                        </ui-select>
                        <div class="error-msg" ng-show="innerform.input.$error.required">Required</div>
                      </ng-form>

                    </div>
                    <button type="submit" class="btn btn-success" ng-disabled="banks.requestSent || addAccountForm.$invalid">Submit</button>
                    <div class="absolute-loader" ng-if="banks.requestSent">
                      <div class="loading-bar"></div>
                      <div class="mrT5">
                        Connecting with Bank.</br>
                        Please Wait, this may take a while.
                      </div>
                    </div>
                  </section>
                </div>
              </div>
            </form>
            <div class="mrT1">NOTE: In case you do not see your bank listed in Added Accounts even after getting a success message, please check again after some time.</div>
            <hr class="mrT2 col-xs-11">
            <div class="mrT2 col-xs-12 pd0">
              <h1 class="pull-left">Added Accounts</h1>
              <button class="btn btn-primary btn-sm pull-right" ng-click="refreshAccounts()" ng-if="linkedAccountsExist">Refresh</button>
              <div class="col-xs-12 mrT1 pd0" ng-if="banks.linked.length > 0">
                <section class="linked-accounts clearfix" ng-repeat="account in banks.linked | orderBy: 'siteName'">
                  <aside class="title" ng-bind="account.siteName"></aside>
                  <aside class="body">
                    <aside class="account-card" ng-repeat="card in account.yodleeAccounts">
                      <h1 ng-bind="card.accountName"  uib-tooltip="{{card.accountName}}"></h1>
                      <div class="account-number">
                        <b>Account</b>: {{card.accountNumber}}
                      </div>
                      <div class="account-date">
                        {{newTransDate.date | date}}
                        <b>Get Entries From</b>: 
                        <a href="javascript:void(0)">
                          <!-- ng-click="refreshTransactionDate()"-->
                           {{card.transactionDate | date}} 
                          <input  
                            ng-change='changedate(card.transactionDate)'
                            type="text" class="transaction-date"
                             uib-datepicker-popup="{{format}}" required
                             datepicker-options="dateOptionsBanks"
                             is-open="fromDatePickerIsOpen"
                             ng-click="fromDatePickerOpen(); setItemAccountId(card)"
                             ng-model="card.transactionDate"
                             max-date="today"
                             min-date="beforeThreeMonths"
                             placeholder="from date"/>
                        </a>
                      </div>
                      <div class="balance">
                        {{card.currentBalanceCurrencyCode}} {{card.currentBalance}}
                      </div>
                      <div class="with" ng-if="card.giddhAccount != null">
                        Linked with: {{card.giddhAccount.name}} ({{card.giddhAccount.uniqueName}})
                      </div>
                      <div class="select-account" ng-if="card.showAccList">
                        <ui-select ng-model="banks.toLink" theme="bootstrap" on-select="LinkGiddhAccountConfirm($select.selected)">
                          <ui-select-match placeholder="Select Accounts">
                            <span>{{$select.selected.name}}</span>
                          </ui-select-match >
                          <ui-select-choices 
                            ui-disable-choice="acc.uniqueName === selAcntUname" 
                            repeat="acc in AccountsList | filter: $select.search">
                            <span>{{acc.name}} ({{acc.uniqueName}})</span>
                          </ui-select-choices>
                        </ui-select>
                      </div>
                      <button class="btn btn-sm btn-warning pull-right" ng-if="card.showAccList" ng-click="card.showAccList = !card.showAccList" style="margin-top:5px">Not Now</button>
                      <button class="btn btn-sm btn-info" ng-if="card.giddhAccount == null && !card.showAccList" ng-click="linkGiddhAccount(card)">Link Account</button>
                      <button class="btn btn-sm btn-danger mrT1" ng-if="card.giddhAccount.name.length > 0" ng-click="removeGiddhAccount(card)">Unlink Account</button>
                      <a class="delete-bank" ng-click="deleteAddedBank(card)" uib-tooltip="Delete Bank" tooltip-placement="left"><i class="glyphicon glyphicon-trash"></i></a>
                    </aside>
                  </aside>
                </section>
              </div>
            </div>
          </div>
        </uib-tab>

      </uib-tabset>
    </perfect-scrollbar>

  </div>
</div>